<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>競價系統 - 登入</title>

<style>
  body {
    font-family: Arial;
    background: #f0f4ff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #login-box {
    background: #fff;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
    width: 300px;
    text-align: center;
  }
  input {
    width: 90%;
    padding: 10px;
    margin-top: 12px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  button {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: none;
    background: #4a6bff;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover { background: #3452e5; }
</style>
</head>

<body>
  <div id="login-box">
    <h2>競價系統</h2>
    <input id="username" type="text" placeholder="輸入用戶名稱">
    <button onclick="doLogin()">登入</button>
    <button onclick="doRegister()">註冊</button>
  </div>

<script>
const backend = "http://bid-alb-1309857608.us-east-1.elb.amazonaws.com";
const usernameInput = document.getElementById("username");

// 按 Enter 鍵登入
usernameInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") doLogin();
});

// 如果 localStorage 有登入資訊，直接跳轉
const storedUser = localStorage.getItem("username");
if(storedUser) window.location.href = "user.html";

// 註冊
function doRegister() {
    const username = usernameInput.value.trim();
    if (!username) return alert("請輸入使用者名稱");

    fetch(`${backend}/user/register`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ username })
    })
    .then(r => r.json())
    .then(data => {
        if (data.status === "ok") {
            localStorage.setItem("username", username);
            localStorage.setItem("weight", data.weight);
            alert("註冊成功！");
            window.location.href = "user.html";
        } else {
            alert(data.message || "註冊失敗");
        }
    });
}

// 登入
function doLogin() {
    const username = usernameInput.value.trim();
    if (!username) return alert("請輸入使用者名稱");

    fetch(`${backend}/user/login`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ username })
    })
    .then(r => r.json())
    .then(data => {
        if (data.status === "ok") {
            localStorage.setItem("username", username);
            localStorage.setItem("weight", data.weight);
            window.location.href = "user.html";
        } else {
            alert(data.message || "登入失敗，請先註冊");
        }
    });
}
</script>
</body>
</html>
